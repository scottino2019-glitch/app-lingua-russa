<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>App Lingua Russa</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Importa il font Inter da Google Fonts per un aspetto pi√π pulito */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    body { 
      font-family: 'Inter', sans-serif; 
      background-color: #f8fafc; /* Leggermente pi√π scuro di gray-50 per un contrasto morbido */
    }

    /* Stile per i pulsanti principali delle lezioni e della navigazione */
    .lezione-btn { 
      @apply bg-gradient-to-br from-purple-500 to-indigo-600 text-white font-extrabold 
             px-8 py-4 rounded-full m-3 shadow-xl 
             hover:from-purple-600 hover:to-indigo-700 hover:scale-105 
             transition-all duration-400 ease-in-out 
             focus:outline-none focus:ring-4 focus:ring-purple-300 active:scale-95
             transform hover:-translate-y-1; /* Aggiunge un leggero sollevamento all'hover */
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2); /* Ombra leggera per il testo */
      letter-spacing: 0.05em; /* Spaziatura tra le lettere */
    }
    
    /* Stile per i pulsanti di navigazione nell'header - mantengono un aspetto pi√π compatto */
    header .lezione-btn {
        @apply !px-5 !py-2 !text-base !m-0 !rounded-lg !shadow-md;
    }

    /* Stile per i titoli di sezione */
    .section-title { 
      @apply text-2xl font-bold mt-8 mb-4 border-b-2 border-blue-400 pb-2 
             text-blue-800; 
    }

    /* Stile per le righe di dialogo */
    .dialogo-line { 
      @apply flex justify-between items-center py-2 px-4 my-1 
             bg-white rounded-lg shadow-sm text-gray-800 
             border-l-4 border-blue-200; 
    }

    /* Stile per le righe del vocabolario */
    .vocabolario-line { 
      @apply flex justify-between items-center py-2 px-4 my-1 
             bg-white rounded-lg shadow-sm text-gray-700 
             border-l-4 border-green-200; 
    }

    /* Stile per i contenitori degli esercizi */
    .esercizio-line { 
      @apply border border-gray-200 p-5 my-4 rounded-xl bg-white shadow-md; 
    }

    /* Stile per il pulsante di verifica (check) */
    .check-btn { 
      @apply bg-green-500 text-white font-medium px-5 py-2 rounded-lg 
             hover:bg-green-600 hover:scale-105 
             transition-all duration-300 ease-in-out 
             mt-3 shadow-md focus:outline-none focus:ring-4 focus:ring-green-300 active:scale-95; 
    }

    /* Stile per il pulsante "Torna alla Home" */
    .back-btn { 
      @apply bg-gray-600 text-white font-medium px-5 py-2 rounded-lg 
             hover:bg-gray-700 hover:scale-105 
             transition-all duration-300 ease-in-out 
             mb-6 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300 active:scale-95; 
    }

    /* Stile per l'input di testo */
    input[type="text"] {
      @apply border-2 border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 
             rounded-lg px-4 py-2 mt-2 w-full text-gray-700;
    }

    /* Stile per il feedback (corretto/errato) */
    .feedback {
        @apply mt-3 p-2 rounded-lg text-center font-semibold;
    }
    .feedback.text-green-600 {
        @apply bg-green-100 text-green-700 border border-green-300;
    }
    .feedback.text-red-600 {
        @apply bg-red-100 text-red-700 border border-red-300;
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- HEADER -->
  <header class="bg-gradient-to-r from-blue-700 via-sky-500 to-red-600 p-5 shadow-xl text-white">
    <div class="max-w-3xl mx-auto flex justify-between items-center">
      <h1 class="text-3xl font-bold tracking-tight">Corso di Russo</h1>
      <nav class="flex space-x-3">
        <button onclick="showHome()" class="lezione-btn">Home</button>
        <button onclick="showContatti()" class="lezione-btn">Contatti</button>
      </nav>
    </div>
  </header>

  <!-- CONTENUTO -->
  <main class="p-6 max-w-4xl mx-auto">
    <!-- HOME -->
    <div id="home">
     <h2 class="text-3xl font-bold mb-6 text-gray-800">Seleziona una lezione</h2>
               
      <div id="lezioni-buttons" class="flex flex-wrap justify-center gap-4"></div>
    </div>

    <!-- LEZIONE -->
    <div id="lezione" class="hidden">
      <button onclick="showHome()" class="back-btn">‚Üê Torna alla Home</button>
      <h2 id="titolo" class="text-3xl font-bold text-gray-800 mb-2"></h2>
      <h3 id="sottotitolo" class="text-xl text-gray-600 mb-8"></h3>

      <div>
        <div class="section-title">Dialogo</div>
        <div id="dialogo"></div>

        <div class="section-title">Vocabolario</div>
        <div id="vocabolario"></div>

        <div class="section-title">Grammatica</div>
        <div id="grammatica" class="bg-white p-6 rounded-xl shadow-md text-gray-700 leading-relaxed text-lg"></div>

        <div class="section-title">Esercizi</div>
        <div id="esercizi"></div>
      </div>
    </div>

    <!-- CONTATTI -->
    <div id="contatti" class="hidden">
      <button onclick="showHome()" class="back-btn">‚Üê Torna alla Home</button>
      <h2 class="text-3xl font-bold mb-6 text-gray-800">Contatti</h2>
      <div id="contatti-dati" class="bg-white p-6 rounded-xl shadow-md text-gray-700 text-lg"></div>
    </div>
  </main>

  <!-- SCRIPT SUPABASE -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://arytlfiqiwdyiykaklmb.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyeXRsZmlxaXdkeWl5a2FrbG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMDEzMTksImV4cCI6MjA3MDU3NzMxOX0.kVWYz6a5hDNazon7LYGK1AF4tnLEp8h-EdFGH17GXL8";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    function showHome() {
      document.getElementById('home').classList.remove('hidden');
      document.getElementById('lezione').classList.add('hidden');
      document.getElementById('contatti').classList.add('hidden');
    }
    function showLezione() {
      document.getElementById('home').classList.add('hidden');
      document.getElementById('lezione').classList.remove('hidden');
      document.getElementById('contatti').classList.add('hidden');
    }
    function showContatti() {
      document.getElementById('home').classList.add('hidden');
      document.getElementById('lezione').classList.add('hidden');
      document.getElementById('contatti').classList.remove('hidden');
      caricaContatti();
    }

    async function caricaLezioni() {
      const { data, error } = await supabaseClient
        .from('lezioni')
        .select('*')
        .order('ordine', { ascending: true });
      if (error) { console.error(error); return; }
      const container = document.getElementById('lezioni-buttons');
      container.innerHTML = '';
      data.forEach(lezione => {
        const btn = document.createElement('button');
        btn.className = 'lezione-btn';
        btn.textContent = lezione.titolo;
        btn.onclick = () => mostraLezione(lezione);
        container.appendChild(btn);
      });
    }

    function mostraLezione(lezione) {
      document.getElementById('titolo').textContent = lezione.titolo;
      document.getElementById('sottotitolo').textContent = lezione.sottotitolo || '';

      const dialogoDiv = document.getElementById('dialogo');
      dialogoDiv.innerHTML = '';
      (lezione.dialogo || []).forEach(riga => {
        const div = document.createElement('div');
        div.className = 'dialogo-line';
        div.innerHTML = `<span>${riga.ru}</span><span>${riga.it}</span>`;
        dialogoDiv.appendChild(div);
      });

      const vocabDiv = document.getElementById('vocabolario');
      vocabDiv.innerHTML = '';
      (lezione.vocabolario || []).forEach(riga => {
        const div = document.createElement('div');
        div.className = 'vocabolario-line';
        div.innerHTML = `<span>${riga.ru}</span><span>${riga.it}</span>`;
        vocabDiv.appendChild(div);
      });

      document.getElementById('grammatica').textContent = lezione.grammatica || '';

      const eserciziDiv = document.getElementById('esercizi');
      eserciziDiv.innerHTML = '';
      (lezione.esercizi || []).forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'esercizio-line';
        div.innerHTML = `
          <strong>${q.domanda}</strong><br>
          <input type="text" id="risposta-${i}" class="border rounded px-2 py-1 mt-1 w-full" placeholder="Scrivi la risposta">
          <button class="check-btn" onclick="controllaRisposta(${i}, '${q.risposta}')">Verifica</button>
          <div id="feedback-${i}" class="feedback mt-2 text-sm"></div>
        `;
        eserciziDiv.appendChild(div);
      });

      showLezione();
    }

    function controllaRisposta(idx, corretta) {
      const userInput = document.getElementById(`risposta-${idx}`).value.trim();
      const feedback = document.getElementById(`feedback-${idx}`);
      if (userInput.toLowerCase() === corretta.toLowerCase()) {
        feedback.textContent = "Corretto! üéâ";
        feedback.className = "feedback text-green-600 font-bold"; /* Aggiornato per le nuove classi */
      } else {
        feedback.textContent = `Risposta errata. Quella giusta era: ${corretta}`;
        feedback.className = "feedback text-red-600 font-bold"; /* Aggiornato per le nuove classi */
      }
    }

    async function caricaContatti() {
      const { data, error } = await supabaseClient.from('contatti').select('*');
      if (error) { console.error(error); return; }
      const container = document.getElementById('contatti-dati');
      container.innerHTML = '';
      data.forEach(c => {
        container.innerHTML += `<p class="mb-2"><strong>${c.nome}</strong> - <a href="mailto:${c.email}" class="text-blue-600 hover:underline">${c.email}</a></p>`;
      });
    }

    caricaLezioni();
  </script>
</body>
</html>
