<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>App Lingua Russa</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: sans-serif; }
    .lezione-btn { @apply bg-blue-600 text-white px-3 py-1 rounded m-1 hover:bg-blue-700; }
    .section-title { @apply text-xl font-bold mt-6 mb-2 border-b pb-1; }
    .dialogo-line { @apply flex justify-between border-b py-1; }
    .vocabolario-line { @apply flex justify-between border-b py-1; }
    .esercizio-line { @apply border p-2 my-1 rounded bg-gray-100; }
  </style>
</head>
<body class="bg-gray-50">
  <!-- HEADER -->
  <header class="bg-blue-600 text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">Corso di Russo</h1>
    <nav>
      <button onclick="showHome()" class="lezione-btn">Home</button>
      <button onclick="showContatti()" class="lezione-btn">Contatti</button>
    </nav>
  </header>

  <!-- CONTENUTO -->
  <main class="p-4 max-w-3xl mx-auto">
    <!-- HOME -->
    <div id="home">
      <h2 class="text-2xl font-bold mb-4">Benvenuto!</h2>
      <p class="mb-4">Seleziona una lezione per iniziare:</p>
      <div id="lezioni-buttons" class="flex flex-wrap"></div>
    </div>

    <!-- LEZIONE -->
    <div id="lezione" class="hidden">
      <button onclick="showHome()" class="bg-gray-500 text-white px-3 py-1 rounded mb-4 hover:bg-gray-600">← Torna alla Home</button>
      <h2 id="titolo" class="text-2xl font-bold"></h2>
      <h3 id="sottotitolo" class="text-lg text-gray-700 mb-4"></h3>

      <div>
        <div class="section-title">Dialogo</div>
        <div id="dialogo"></div>

        <div class="section-title">Vocabolario</div>
        <div id="vocabolario"></div>

        <div class="section-title">Grammatica</div>
        <div id="grammatica" class="bg-white p-2 rounded shadow"></div>

        <div class="section-title">Esercizi</div>
        <div id="esercizi"></div>
      </div>
    </div>

    <!-- CONTATTI -->
    <div id="contatti" class="hidden">
      <button onclick="showHome()" class="bg-gray-500 text-white px-3 py-1 rounded mb-4 hover:bg-gray-600">← Torna alla Home</button>
      <h2 class="text-2xl font-bold mb-4">Contatti</h2>
      <div id="contatti-dati" class="bg-white p-4 rounded shadow"></div>
    </div>
  </main>

  <!-- SCRIPT SUPABASE -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://arytlfiqiwdyiykaklmb.supabase.co";  // <-- la tua URL
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyeXRsZmlxaXdkeWl5a2FrbG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMDEzMTksImV4cCI6MjA3MDU3NzMxOX0.kVWYz6a5hDNazon7LYGK1AF4tnLEp8h-EdFGH17GXL8";                     // <-- la tua chiave
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Cambia visibilità sezioni
    function showHome() {
      document.getElementById('home').classList.remove('hidden');
      document.getElementById('lezione').classList.add('hidden');
      document.getElementById('contatti').classList.add('hidden');
    }
    function showLezione() {
      document.getElementById('home').classList.add('hidden');
      document.getElementById('lezione').classList.remove('hidden');
      document.getElementById('contatti').classList.add('hidden');
    }
    function showContatti() {
      document.getElementById('home').classList.add('hidden');
      document.getElementById('lezione').classList.add('hidden');
      document.getElementById('contatti').classList.remove('hidden');
      caricaContatti();
    }

    // Carica lezioni e crea pulsanti
    async function caricaLezioni() {
      const { data, error } = await supabaseClient
        .from('lezioni')
        .select('*')
        .order('ordine', { ascending: true });
      if (error) {
        console.error(error);
        return;
      }
      const container = document.getElementById('lezioni-buttons');
      container.innerHTML = '';
      data.forEach(lezione => {
        const btn = document.createElement('button');
        btn.className = 'lezione-btn';
        btn.textContent = lezione.titolo;
        btn.onclick = () => mostraLezione(lezione);
        container.appendChild(btn);
      });
    }

    // Mostra contenuto lezione
    function mostraLezione(lezione) {
      document.getElementById('titolo').textContent = lezione.titolo;
      document.getElementById('sottotitolo').textContent = lezione.sottotitolo || '';

      // Dialogo
      const dialogoDiv = document.getElementById('dialogo');
      dialogoDiv.innerHTML = '';
      (lezione.dialogo || []).forEach(riga => {
        const div = document.createElement('div');
        div.className = 'dialogo-line';
        div.innerHTML = `<span>${riga.ru}</span><span>${riga.it}</span>`;
        dialogoDiv.appendChild(div);
      });

      // Vocabolario
      const vocabDiv = document.getElementById('vocabolario');
      vocabDiv.innerHTML = '';
      (lezione.vocabolario || []).forEach(riga => {
        const div = document.createElement('div');
        div.className = 'vocabolario-line';
        div.innerHTML = `<span>${riga.ru}</span><span>${riga.it}</span>`;
        vocabDiv.appendChild(div);
      });

      // Grammatica
      document.getElementById('grammatica').textContent = lezione.grammatica || '';

      // Esercizi
      const eserciziDiv = document.getElementById('esercizi');
      eserciziDiv.innerHTML = '';
      (lezione.esercizi || []).forEach(q => {
        const div = document.createElement('div');
        div.className = 'esercizio-line';
        div.innerHTML = `<strong>${q.domanda}</strong><br>Risposta: ${q.risposta}`;
        eserciziDiv.appendChild(div);
      });

      showLezione();
    }

    // Carica contatti
    async function caricaContatti() {
      const { data, error } = await supabaseClient.from('contatti').select('*');
      if (error) { console.error(error); return; }
      const container = document.getElementById('contatti-dati');
      container.innerHTML = '';
      data.forEach(c => {
        container.innerHTML += `<p><strong>${c.nome}</strong> - ${c.email}</p>`;
      });
    }

    // Avvio
    caricaLezioni();
  </script>
</body>
</html>


